{"version":3,"sources":["component/VisualTools/Chart/ScatterChart.js"],"names":["Component","ScatterChart","props","self","React","createRef","state","margin","top","right","bottom","left","loading","error","data","filter","d","fields","x","y","z","f","width","xScale","d3","scaleBand","domain","map","range","padding","scaleLiner","scaleLinear","extent","nice","console","log","filters","length","circles","attr","filterData","includes","rect","current","getBoundingClientRect","innerWidth","innerHeight","height","viewer","select","append","createScaleLiner","yScale","radiusScale","call","axisBottom","tickSize","axisLeft","selectAll","enter","brush","on","end","bind","brush_area","event","selection","brush_coords","i","nodes","node","cx","cy","isBrushed","x0","y0","x1","y1","id","title","field","operation","values","invert","filterAdded","move"],"mappings":"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","file":"ScatterChart.4fa88607.js","sourceRoot":"../source","sourcesContent":["import React, { Component } from 'react'\nimport {numFixed} from '../../../common/utils.js'; \nimport * as d3 from \"d3\";\nimport \"./style.css\";\nexport default class ScatterChart extends Component {\n    constructor(props) {\n        super(props);\n        this.self = React.createRef();\n        this.state = {\n            margin: {top: 10, right: 10, bottom: 25, left: 40},\n            loading:true,\n            error:null\n        }\n        this.state.data = this.props.data.filter(d=> d[this.props.fields.x]!='N/A'&&d[this.props.fields.y]!='N/A'&&d[this.props.fields.z]!='N/A' )\n    }\n\n    createXScale(f,width) {\n        // set the ranges\n        const xScale = d3.scaleBand()\n            .domain(this.state.data.map(function(d) { return d[f]; }))\n            .range([0, width])\n            .padding(0.1);\n\n        // xScale.invert = function(x) {\n        //     var domain = this.domain();\n        //     var range = this.range()\n        //     var scale = d3.scaleQuantize().domain(range).range(domain)\n        //     return scale(x)\n        // }\n        return xScale;\n    }\n\n    createScaleLiner(f, range) {\n        const scaleLiner = d3.scaleLinear()\n        .domain(d3.extent(this.state.data, d=>d[f]))\n        .range(range)\n        .nice();\n        return scaleLiner;\n    }\n\n    componentDidUpdate(){\n        console.log('componentDidUpdate')\n        if(this.props.filters.length > 0){\n            this.circles.attr('class', d=> this.props.filterData.includes(d)?'brushed':'non_brushed')\n        }else{\n            this.circles.attr('class','brushed')\n        }\n    }\n\n    componentDidMount() {\n        const rect = this.self.current.getBoundingClientRect();\n        const innerWidth = rect.width - this.state.margin.left - this.state.margin.right;\n        const innerHeight = rect.height - this.state.margin.top - this.state.margin.bottom;\n        // create svg \n        const svg = d3.select(this.self.current)\n        .append(\"svg\")\n            .attr(\"width\", rect.width)\n            .attr(\"height\", rect.height)\n        // create viewer\n        const viewer = svg.append(\"g\")\n            .attr(\"transform\", \"translate(\" + this.state.margin.left + \",\" + this.state.margin.top + \")\");\n        //\n        this.xScale = this.createScaleLiner(this.props.fields.x, [0, innerWidth]);\n        this.yScale = this.createScaleLiner(this.props.fields.y, [innerHeight, 0]);\n\n        this.radiusScale = this.createScaleLiner(this.props.fields.z, [3, 10]);\n\n        viewer.append(\"g\")\n        .attr(\"transform\", \"translate(0,\" + innerHeight + \")\")\n        .call(d3.axisBottom(this.xScale).tickSize(-innerHeight));\n        \n        // add the y Axis\n        viewer.append(\"g\")\n            .call(d3.axisLeft(this.yScale).tickSize(-innerWidth));\n\n\n\n        this.circles = viewer.selectAll(\"circle\").data(this.state.data)\n        .enter().append(\"circle\")\n        .attr(\"r\", d => this.radiusScale(d[this.props.fields.z]))\n        .attr(\"cx\", d => this.xScale(d[this.props.fields.x]))\n        .attr(\"cy\", d => this.yScale(d[this.props.fields.y]))\n        .attr(\"class\", \"brushed\");\n\n\n\n        this.brush = d3.brush().extent([[0,0],[innerWidth, innerHeight]])\n            //.on(\"brush\", this.brushed.bind(this))\n            .on(\"end\", this.end.bind(this)); \n\n        this.brush_area = viewer.append(\"g\")\n        \n        .call(this.brush);\n        \n    }\n    brushed(){\n        if (d3.event.selection != null) {\n            // revert circles to initial style\n            this.circles.attr(\"class\", \"non_brushed\");\n            // d3.event.selection\n            var brush_coords = d3.event.selection\n            // // style brushed circles\n            this.circles.filter(function(d,i,nodes){\n                      const node = nodes[i]\n                       var cx = d3.select(node).attr(\"cx\"),\n                           cy = d3.select(node).attr(\"cy\");\n                       return this.isBrushed(brush_coords, cx, cy);\n                   }.bind(this))\n                   .attr(\"class\", \"brushed\");\n        }\n    }\n    end(){\n        \n        if (!d3.event.selection) return;\n        var [x0, y0] = d3.event.selection[0],\n        [x1, y1] = d3.event.selection[1];\n        console.log('end', d3.event.selection)\n        const filters = [\n            {\n                id:this.props.id,\n                title:this.props.title,\n                field:this.props.fields.x,\n                operation:'range',\n                values:[numFixed(this.xScale.invert(x0)),numFixed(this.xScale.invert(x1))]\n            },\n            {\n                id:this.props.id,\n                title:this.props.title,\n                field:this.props.fields.y,\n                operation:'range',\n                values:[numFixed(this.yScale.invert(y1)),numFixed(this.yScale.invert(y0))]\n            }\n        ]\n        console.log(filters)\n        this.props.filterAdded(filters)\n        this.brush_area.call(this.brush.move, null);\n\n\n\n    }\n    createBrush(){\n    }\n\n    isBrushed(brush_coords, cx, cy) {\n        var [x0, y0] = brush_coords[0],\n            [x1, y1] = brush_coords[1];\n       return x0 <= cx && cx <= x1 && y0 <= cy && cy <= y1;\n   }\n\n    render() {\n        return (\n            <div\n              id={this.props.id}\n              ref={this.self}\n              style={{ width: \"100%\", height: \"100%\" }}\n            ></div>\n        );\n        return (\n        <div >\n          <svg width={this.props.width} height={this.props.height}>\n            {this.state.bars.map((d, i) => (\n              <rect\n                key={i}\n                x={d.x}\n                y={d.y}\n                width=\"2\"\n                height={d.height}\n                fill={d.fill}\n              />\n            ))}\n            <g>\n              <g\n                ref=\"xAxis\"\n                transform={`translate(0, ${height - margin.bottom})`}\n              />\n              <g ref=\"yAxis\" transform={`translate(${margin.left}, 0)`} />\n              <g ref=\"brush\" />\n            </g>\n          </svg>\n          </div>\n        );\n      }\n}\n"]}